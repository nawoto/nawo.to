---
import '../styles/global.css';
import Bio from '../components/Bio.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import SEO from '../components/SEO.astro';
import { SITE } from '../config';

interface Props {
  title: string;
  isRootPath?: boolean;
  description?: string;
  image?: string;
}

const { 
  title, 
  isRootPath = false,
  description = SITE.description,
  image
} = Astro.props;

const pageTitle = title || SITE.title;
const metaDescription = description || SITE.description;
const ogImageUrl = image ? new URL(image, SITE.url).href : new URL('/images/opengraph-default.png', SITE.url).href;
const currentUrl = new URL(Astro.url.pathname, SITE.url).href;
---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <SEO
      title={pageTitle}
      description={metaDescription}
      canonical={currentUrl}
      charset="UTF-8"
      openGraph={{
        basic: {
          type: "website",
          title: pageTitle,
          image: ogImageUrl,
          url: currentUrl
        },
        optional: {
          description: metaDescription,
          siteName: SITE.title,
          locale: "ja_JP"
        }
      }}
      twitter={{
        card: "summary_large_image",
        site: `@${SITE.social.twitter}`,
        creator: `@${SITE.social.twitter}`,
        title: pageTitle,
        description: metaDescription,
        image: ogImageUrl
      }}
      extend={{
        meta: [
          { name: "viewport", content: "width=device-width, initial-scale=1.0" },
          { name: "author", content: SITE.author.name },
          { name: "robots", content: "index, follow" },
          { name: "googlebot", content: "index, follow" }
        ],
        link: [
          { rel: "me authn", href: `https://twitter.com/${SITE.social.twitter}` },
          { rel: "me", href: "https://github.com/nawoto/" },
          { rel: "me", href: "https://speakerdeck.com/nawoto" },
          { rel: "me", href: "https://www.instagram.com/nawoto/" },
          { rel: "me", href: "https://www.facebook.com/nishimura.nawoto" },
          { rel: "me", href: "https://www.amazon.co.jp/~/e/B00B46MLPG" },
          { rel: "webmention", href: "https://webmention.io/nawo.to/webmention" },
          { rel: "pingback", href: "https://webmention.io/nawo.to/xmlrpc" },
          { rel: "alternate", type: "application/rss+xml", title: SITE.title, href: "/rss.xml" },
          { rel: "icon", type: "image/x-icon", href: "/favicon.ico" },
          { rel: "apple-touch-icon", href: "/images/site-icon.png" }
        ]
      }}
    />
    
    <!-- WebSite JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": SITE.title,
      "description": SITE.description,
      "url": SITE.url,
      "author": {
        "@type": "Person",
        "name": SITE.author.name,
        "url": SITE.url
      },
      "publisher": {
        "@type": "Organization",
        "name": SITE.title,
        "description": SITE.description,
        "url": SITE.url,
        "logo": {
          "@type": "ImageObject",
          "url": new URL('/images/site-icon.png', SITE.url).href,
          "width": 512,
          "height": 512
        },
        "sameAs": [
          `https://twitter.com/${SITE.social.twitter}`,
          "https://github.com/nawoto/",
          "https://speakerdeck.com/nawoto",
          "https://www.instagram.com/nawoto/",
          "https://www.facebook.com/nishimura.nawoto",
          "https://www.amazon.co.jp/~/e/B00B46MLPG"
        ]
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": `${SITE.url}/search?q={search_term_string}`
        },
        "query-input": "required name=search_term_string"
      }
    })} />
    
    <!-- Additional head content from child layouts -->
    <slot name="head" />
  </head>
  <body class="mx-auto max-w-screen-xl">
    <Header />
    
    <main>
      <div class="md:flex md:flex-row">
        <div class="md:order-last md:basis-3/4">
          <slot />
        </div>
        <div class="border-r md:basis-1/4">
          <Bio />
        </div>
      </div>
    </main>

    <Footer />
    <div class="mt-2">
      <a href="/privacy" class="link">Privacy Policy</a>
    </div>
    <script is:inline src="/js/amazon-cards.js"></script>
  </body>
</html> 