---
import { getBookByAsin } from '../data/books';
import { SITE } from '../config';

interface Props {
  asin: string;
}

const { asin } = Astro.props;
const book = getBookByAsin(asin);

if (!book) {
  throw new Error(`Book with ASIN ${asin} not found`);
}

// è¥¿æ‘ç›´äººã®åå‰ã‚’å¤ªå­—ã«ã™ã‚‹é–¢æ•°
function formatAuthorName(author: string): string {
  return author.replace(/è¥¿æ‘\s*ç›´äºº/g, '<strong>è¥¿æ‘ ç›´äºº</strong>');
}

const amazonUrl = `https://www.amazon.co.jp/dp/${book.asin}?tag=${SITE.affiliate.amazon}`;
---

<div class="book-card">
  <div class="book-cover">
    <picture>
      <source srcset={book.coverImage.replace('.png', '.webp')} type="image/webp" />
      <img src={book.coverImage} alt={`${book.title} ã®è¡¨ç´™`} />
    </picture>
  </div>
  <div class="book-info">
    <h3 class="book-title">ğŸ“š {book.title}</h3>
    <p class="book-author" set:html={formatAuthorName(book.author)}></p>
    <p class="book-description">{book.description}</p>
    <a href={amazonUrl} class="amazon-link" target="_blank" rel="noopener noreferrer">
      ğŸ“– Amazonã§è¦‹ã‚‹
    </a>
  </div>
</div> 